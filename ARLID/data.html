<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</title>
  <link rel="icon" href="https://rep-arlington.pages.dev/assets/img/logo.png" type="image/gif" sizes="16x16">
  <link rel="stylesheet" href="https://slw-system.pages.dev/assets/css/font-face.css">
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: CPN;
      font-size: 1.5rem;
    }
    #log {
      background: #f1f1f1;
      padding: 1rem;
      border-radius: 8px;
      margin-top: 1rem;
      white-space: pre-line;
    }
  </style>
</head>
<body>
  <h2>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...</h2>
  <div id="log">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î...</div>

  <script>
    const logEl = document.getElementById("log");
    function log(text) {
      console.log(text);
      logEl.textContent += `\n${text}`;
    }

    const apiUrl = "https://script.google.com/macros/s/AKfycbz3MGxCG1OSpLa6Wh1n4i1SDLAHCvoAU9DB5RICnyasEeUEpTk-lNadVz-YL_AaMSDTtw/exec";
    const userDataEncoded = localStorage.getItem('election_user_data');

    function redirectToDashboard() {
      log("‚Üí ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏•‡∏±‡∏ö /ARLID/dashboard");
      setTimeout(() => {
        window.location.href = "/ARLID/dashboard";
      }, 1500);
    }

    async function start() {
      log("üì¶ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å LocalStorage...");
      if (!userDataEncoded) {
        log("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• election_user_data");
        return redirectToDashboard();
      }

      let userData;
      try {
        userData = JSON.parse(atob(userDataEncoded));
        log(`‚úÖ ‡πÅ‡∏Å‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢: ID = ${userData.id}`);
      } catch (err) {
        log("‚ùå ‡πÅ‡∏Å‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: " + err.message);
        return redirectToDashboard();
      }

      if (!userData.id) {
        log("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö userData.id");
        return redirectToDashboard();
      }

      log("üåê ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å API...");
      try {
        const response = await fetch(apiUrl);
        const data = await response.json();
        log("‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• API ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");

        log(`üîç ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ID: ${userData.id} ‡∏à‡∏≤‡∏Å API...`);
        const match = data.find(item => item.id === userData.id);

        if (!match) {
          log("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö ID");
          return redirectToDashboard();
        }

        log(`‚úÖ ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: link = ${match.link}`);
        if (match.link === "Unable to access this website") {
          alert("‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ");
          return redirectToDashboard();
        } else {
          const redirectUrl = "data-eca" + match.link;
          log(`‚û° ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á ${redirectUrl}`);
          setTimeout(() => {
            window.location.href = redirectUrl;
          }, 1500);
        }
      } catch (err) {
        log("‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å API ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + err.message);
        return redirectToDashboard();
      }
    }

    start();
  </script>
</body>
</html>
